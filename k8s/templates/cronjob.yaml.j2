apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ app_name }}-job
  namespace: app-{{ app_name }}
  labels:
    app: {{ app_name }}
spec:
  schedule: "{{ schedule | default('0 * * * *') }}"
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: {{ app_name }}
        spec:
          restartPolicy: OnFailure
          containers:
          - name: job
            image: {{ registry_host }}/{{ app_name }}:{{ version }}
            envFrom:
            - configMapRef:
                name: {{ app_name }}-env
                optional: true
            resources:
              requests:
                cpu: "50m"
                memory: "64Mi"
              limits:
                cpu: "200m"
                memory: "128Mi"
